(function(){function r(){function k(a,b){"Object"==typeof a?(this.x=a.x,this.y=a.y):(this.x=a,this.y=b)}function m(a,b){this.p1=a;this.p2=b}function q(){for(var a=0,b;b=f.enemies[a];a++)w(b,"ASTEROIDSYEAHENEMY");b=document.body.getElementsByTagName("*");f.enemies=[];for(var a=0,c;c=b[a];a++)if(-1==n(x,c.tagName.toUpperCase())&&"g_vml_"!=c.prefix&&A(c)&&"ASTEROIDSYEAH"!=c.className&&0<c.offsetHeight){var d=c,e=c,g=0,h=0;do g+=e.offsetLeft||0,h+=e.offsetTop||0,e=e.offsetParent;while(e);d.aSize={x:g,
y:h,width:c.offsetWidth||10,height:c.offsetHeight||10};f.enemies.push(c);s(c,"ASTEROIDSYEAHENEMY");c.aAdded||(c.aAdded=!0,f.totalEnemies++)}}function d(a){var b={up:38,down:40,left:37,right:39,esc:27};return b[a]?b[a]:a.charCodeAt(0)}function p(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&(a["e"+b+c]=c,a[b+c]=function(){a["e"+b+c](window.event)},a.attachEvent("on"+b,a[b+c]))}function t(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&(a.detachEvent("on"+
b,a[b+c]),a[b+c]=null,a["e"+b+c]=null)}function y(a){for(var b=0,c;c=window.ASTEROIDSPLAYERS[b];b++)c.gameContainer.style.visibility=a}function r(a){for(var b=(new Date).getTime(),c=K,d=0;d<c;d++)f.particles.push({dir:(new k(20*Math.random()-10,20*Math.random()-10)).normalize(),pos:a.cp(),cameAlive:b})}function A(a){if(-100>a.offsetLeft&&0<a.offsetWidth&&0<a.offsetHeight)return!1;if(-1!=n(B,a.tagName))return!0;if(0==a.offsetWidth&&0==a.offsetHeight)return!1;for(var b=0;b<a.childNodes.length;b++)if(-1==
n(B,a.childNodes[b].tagName)&&0!=a.childNodes[b].childNodes.length)return!1;return!0}function n(a,b,c){if(a.indexOf)return a.indexOf(b,c);var d=a.length;for(c=0>c?Math.max(0,d+c):c||0;c<d;c++)if(a[c]===b)return c;return-1}function s(a,b){-1==a.className.indexOf(b)&&(a.className=(a.className+" "+b).replace(/\s+/g," ").replace(/^\s+|\s+$/g,""))}function w(a,b){a.className=a.className.replace(RegExp("(^|\\s)"+b+"(?:\\s|$)"),"$1")}function L(){t(document,"keydown",C);t(document,"keypress",D);t(document,
"keyup",E);t(window,"resize",F);var a=document.getElementById("ASTEROIDSYEAHSTYLES");a&&a.parentNode.removeChild(a);w(document.body,"ASTEROIDSYEAH");this.gameContainer.parentNode.removeChild(this.gameContainer)}window.ASTEROIDS||(window.ASTEROIDS={enemiesKilled:0});k.prototype={cp:function(){return new k(this.x,this.y)},mul:function(a){this.x*=a;this.y*=a;return this},mulNew:function(a){return new k(this.x*a,this.y*a)},add:function(a){this.x+=a.x;this.y+=a.y;return this},addNew:function(a){return new k(this.x+
a.x,this.y+a.y)},sub:function(a){this.x-=a.x;this.y-=a.y;return this},subNew:function(a){return new k(this.x-a.x,this.y-a.y)},rotate:function(a){var b=this.x,c=this.y;this.x=b*Math.cos(a)-Math.sin(a)*c;this.y=b*Math.sin(a)+Math.cos(a)*c;return this},rotateNew:function(a){return this.cp().rotate(a)},setAngle:function(a){var b=this.len();this.x=Math.cos(a)*b;this.y=Math.sin(a)*b;return this},setAngleNew:function(a){return this.cp().setAngle(a)},setLength:function(a){var b=this.len();b?this.mul(a/b):
this.x=this.y=a;return this},setLengthNew:function(a){return this.cp().setLength(a)},normalize:function(){var a=this.len();this.x/=a;this.y/=a;return this},normalizeNew:function(){return this.cp().normalize()},angle:function(){return Math.atan2(this.y,this.x)},collidesWith:function(a){return this.x>a.x&&this.y>a.y&&this.x<a.x+a.width&&this.y<a.y+a.height},len:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);return 0.005>a&&-0.005<a?0:a},is:function(a){return"object"==typeof a&&this.x==a.x&&
this.y==a.y},toString:function(){return"[Vector("+this.x+", "+this.y+") angle: "+this.angle()+", length: "+this.len()+"]"}};m.prototype={shift:function(a){this.p1.add(a);this.p2.add(a)},intersectsWithRect:function(a){var b=new k(a.x,a.y+a.height),c=new k(a.x,a.y),d=new k(a.x+a.width,a.y+a.height);a=new k(a.x+a.width,a.y);return this.p1.x>b.x&&this.p1.x<a.x&&this.p1.y<b.y&&this.p1.y>a.y&&this.p2.x>b.x&&this.p2.x<a.x&&this.p2.y<b.y&&this.p2.y>a.y||this.intersectsLine(new m(c,b))||this.intersectsLine(new m(b,
d))||this.intersectsLine(new m(c,a))||this.intersectsLine(new m(a,d))?!0:!1},intersectsLine:function(a){var b=this.p1,c=this.p2,d=a.p1,e=a.p2;a=(e.y-d.y)*(c.x-b.x)-(e.x-d.x)*(c.y-b.y);if(0==a)return!1;e=((e.x-d.x)*(b.y-d.y)-(e.y-d.y)*(b.x-d.x))/a;b=((c.x-b.x)*(b.y-d.y)-(c.y-b.y)*(b.x-d.x))/a;return 0<=e&&1>=e&&0<=b&&1>=b}};var f=this,u=!!window.ActiveXObject,v=u&&"BackCompat"==document.compatMode,l=document.documentElement.clientWidth,h=document.documentElement.clientHeight;v&&(l=document.body.clientWidth,
h=document.body.clientHeight);var G=[[-15,-10],[-15,10],[15,0]],x="HTML HEAD BODY SCRIPT TITLE META STYLE LINK".split(" ");window.ActiveXObject&&(x="HTML HEAD BODY SCRIPT TITLE META STYLE LINK SHAPE LINE GROUP IMAGE STROKE FILL SKEW PATH TEXTPATH INS".split(" "));var B=["BR","HR"],K=u?20:40,M=u?10:20;this.flame={r:[],y:[]};this.toggleBlinkStyle=function(){this.updated.blink.isActive?w(document.body,"ASTEROIDSBLINK"):s(document.body,"ASTEROIDSBLINK");this.updated.blink.isActive=!this.updated.blink.isActive};
(function(a,b){var c=document.createElement("style");c.type="text/css";c.rel="stylesheet";c.id="ASTEROIDSYEAHSTYLES";try{c.innerHTML=a+"{"+b+"}"}catch(d){c.styleSheet.addRule(a,b)}document.getElementsByTagName("head")[0].appendChild(c)})(".ASTEROIDSBLINK .ASTEROIDSYEAHENEMY","outline: 2px dotted red;");this.pos=new k(100,100);this.lastPos=!1;this.vel=new k(0,0);this.dir=new k(0,1);this.keysPressed={};this.firedAt=!1;this.updated={enemies:!1,flame:(new Date).getTime(),blink:{time:0,isActive:!1}};this.scrollPos=
new k(0,0);this.bullets=[];this.enemies=[];this.dying=[];this.totalEnemies=0;this.particles=[];q();var z;(function(){var a=12*0.2;z=function(){f.flame.r=[[-15,-10]];f.flame.y=[[-15,-6]];for(var b=0;20>b;b+=2)f.flame.r.push([-Math.floor(8*Math.random()+2)-15,b-10]);f.flame.r.push([-15,10]);for(b=0;12>b;b+=a)f.flame.y.push([-Math.floor(8*Math.random()+2)-15,b-6]);f.flame.y.push([-15,6])}})();z();this.gameContainer=document.createElement("div");this.gameContainer.className="ASTEROIDSYEAH";document.body.appendChild(this.gameContainer);
this.canvas=document.createElement("canvas");this.canvas.setAttribute("width",l);this.canvas.setAttribute("height",h);this.canvas.className="ASTEROIDSYEAH";with(this.canvas.style)width=l+"px",height=h+"px",position="fixed",right=bottom=left=top="0px",zIndex="10000";"undefined"!=typeof G_vmlCanvasManager?(this.canvas=G_vmlCanvasManager.initElement(this.canvas),this.canvas.getContext||alert("So... you're using IE?  Please join me at http://github.com/erkie/erkie.github.com if you think you can help")):
this.canvas.getContext||alert("This program does not yet support your browser. Please join me at http://github.com/erkie/erkie.github.com if you think you can help");p(this.canvas,"mousedown",function(a){a=a||window.event;var b=document.createElement("span");b.style.position="absolute";b.style.border="1px solid #999";b.style.background="white";b.style.color="black";b.innerHTML="Press Esc to quit";document.body.appendChild(b);var c=a.pageY||a.clientY+document.documentElement.scrollTop;b.style.left=
(a.pageX||a.clientX+document.documentElement.scrollLeft)-b.offsetWidth/2+"px";b.style.top=c-b.offsetHeight/2+"px";setTimeout(function(){try{b.parentNode.removeChild(b)}catch(a){}},1E3)});var F=function(){if(u)l=document.documentElement.clientWidth,h=document.documentElement.clientHeight,v&&(l=document.body.clientWidth,h=document.body.clientHeight),f.canvas.setAttribute("width",l),f.canvas.setAttribute("height",h);else{f.canvas.style.display="none";l=document.documentElement.clientWidth;h=document.documentElement.clientHeight;
f.canvas.setAttribute("width",l);f.canvas.setAttribute("height",h);with(f.canvas.style)display="block",width=l+"px",height=h+"px"}};p(window,"resize",F);this.gameContainer.appendChild(this.canvas);this.ctx=this.canvas.getContext("2d");this.ctx.fillStyle="black";this.ctx.strokeStyle="black";if(document.getElementById("ASTEROIDS-NAVIGATION"))this.navigation=document.getElementById("ASTEROIDS-NAVIGATION"),this.points=document.getElementById("ASTEROIDS-POINTS");else{this.navigation=document.createElement("div");
this.navigation.id="ASTEROIDS-NAVIGATION";this.navigation.className="ASTEROIDSYEAH";with(this.navigation.style)fontFamily="Arial,sans-serif",position="fixed",zIndex="10001",right=bottom="10px",textAlign="right";this.navigation.innerHTML="(press esc to quit) ";this.gameContainer.appendChild(this.navigation);this.points=document.createElement("span");this.points.id="ASTEROIDS-POINTS";this.points.style.font="28pt Arial, sans-serif";this.points.style.fontWeight="bold";this.points.className="ASTEROIDSYEAH";
this.navigation.appendChild(this.points)}v&&(this.gameContainer.style.position=this.canvas.style.position=this.navigation.style.position="absolute");f.points.innerHTML=10*window.ASTEROIDS.enemiesKilled;if("undefined"!=typeof G_vmlCanvasManager)for(var N=this.canvas.getElementsByTagName("*"),H=0,I;I=N[H];H++)s(I,"ASTEROIDSYEAH");var C=function(a){a=a||window.event;f.keysPressed[a.keyCode]=!0;switch(a.keyCode){case d(" "):f.firedAt=1}if(-1!=n([d("up"),d("down"),d("right"),d("left"),d(" "),d("B"),d("W"),
d("A"),d("S"),d("D")],a.keyCode))return a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.returnValue=!1,a.cancelBubble=!0,!1};p(document,"keydown",C);var D=function(a){a=a||window.event;if(-1!=n([d("up"),d("down"),d("right"),d("left"),d(" "),d("W"),d("A"),d("S"),d("D")],a.keyCode||a.which))return a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.returnValue=!1,a.cancelBubble=!0,!1};p(document,"keypress",D);var E=function(a){a=a||window.event;
f.keysPressed[a.keyCode]=!1;if(-1!=n([d("up"),d("down"),d("right"),d("left"),d(" "),d("B"),d("W"),d("A"),d("S"),d("D")],a.keyCode))return a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.returnValue=!1,a.cancelBubble=!0,!1};p(document,"keyup",E);this.ctx.clear=function(){this.clearRect(0,0,l,h)};this.ctx.clear();this.ctx.drawLine=function(a,b,c,d){this.beginPath();this.moveTo(a,b);this.lineTo(c,d);this.lineTo(c+1,d+1);this.closePath();this.fill()};this.ctx.tracePoly=function(a){this.beginPath();
this.moveTo(a[0][0],a[0][1]);for(var b=1;b<a.length;b++)this.lineTo(a[b][0],a[b][1]);this.closePath()};this.ctx.drawPlayer=function(){this.save();this.translate(f.pos.x,f.pos.y);this.rotate(f.dir.angle());this.tracePoly(G);this.fillStyle="white";this.fill();this.tracePoly(G);this.stroke();this.restore()};var O=2*Math.PI;this.ctx.drawBullets=function(a){for(var b=0;b<a.length;b++)this.beginPath(),this.arc(a[b].pos.x,a[b].pos.y,2,0,O,!0),this.closePath(),this.fill()};this.ctx.drawParticles=function(a){for(var b=
this.fillStyle,c=0;c<a.length;c++)this.fillStyle=["red","yellow"][Math.floor(2*Math.random()+0)],this.drawLine(a[c].pos.x,a[c].pos.y,a[c].pos.x-10*a[c].dir.x,a[c].pos.y-10*a[c].dir.y);this.fillStyle=b};this.ctx.drawFlames=function(a){this.save();this.translate(f.pos.x,f.pos.y);this.rotate(f.dir.angle());var b=this.strokeStyle;this.strokeStyle="red";this.tracePoly(a.r);this.stroke();this.strokeStyle="yellow";this.tracePoly(a.y);this.stroke();this.strokeStyle=b;this.restore()};try{window.focus()}catch(Q){}r(this.pos);
s(document.body,"ASTEROIDSYEAH");var J=(new Date).getTime();this.update=function(){var a=!1,b=(new Date).getTime(),c=(b-J)/1E3;J=b;var k=!1;50<b-this.updated.flame&&(z(),this.updated.flame=b);this.scrollPos.x=window.pageXOffset||document.documentElement.scrollLeft;this.scrollPos.y=window.pageYOffset||document.documentElement.scrollTop;this.keysPressed[d("up")]||this.keysPressed[d("W")]?(this.vel.add(this.dir.mulNew(300*c)),k=!0):this.vel.mul(0.96);if(this.keysPressed[d("left")]||this.keysPressed[d("A")])a=
!0,this.dir.rotate(-6.2831852999999995*c);if(this.keysPressed[d("right")]||this.keysPressed[d("D")])a=!0,this.dir.rotate(6.2831852999999995*c);this.keysPressed[d(" ")]&&150<b-this.firedAt&&(this.bullets.unshift({dir:this.dir.cp(),pos:this.pos.cp(),startVel:this.vel.cp(),cameAlive:b}),this.firedAt=b,this.bullets.length>M&&this.bullets.pop());this.keysPressed[d("B")]?(this.updated.enemies||(q(),this.updated.enemies=!0),a=!0,this.updated.blink.time+=1E3*c,250<this.updated.blink.time&&(this.toggleBlinkStyle(),
this.updated.blink.time=0)):this.updated.enemies=!1;if(this.keysPressed[d("esc")])L.apply(this);else{600<this.vel.len()&&this.vel.setLength(600);this.pos.add(this.vel.mulNew(c));this.pos.x>l?(window.scrollTo(this.scrollPos.x+50,this.scrollPos.y),this.pos.x=0):0>this.pos.x&&(window.scrollTo(this.scrollPos.x-50,this.scrollPos.y),this.pos.x=l);this.pos.y>h?(window.scrollTo(this.scrollPos.x,this.scrollPos.y+0.75*h),this.pos.y=0):0>this.pos.y&&(window.scrollTo(this.scrollPos.x,this.scrollPos.y-0.75*h),
this.pos.y=h);for(var e=this.bullets.length-1;0<=e;e--)if(2E3<b-this.bullets[e].cameAlive)this.bullets.splice(e,1),a=!0;else{var g=this.bullets[e].dir.setLengthNew(700*c).add(this.bullets[e].startVel.mulNew(c));this.bullets[e].pos.add(g);g=this.bullets[e].pos;g.x>l?g.x=0:0>g.x&&(g.x=l);g.y>h?g.y=0:0>g.y&&(g.y=h);var g=this.bullets[e].pos.x,m=this.bullets[e].pos.y;y("hidden");(g=document.elementFromPoint(g,m))?(3==g.nodeType&&(g=g.parentNode),y("visible")):(y("visible"),g=!1);g&&g.tagName&&-1==n(x,
g.tagName.toUpperCase())&&A(g)&&"ASTEROIDSYEAH"!=g.className&&(didKill=!0,r(this.bullets[e].pos),this.dying.push(g),this.bullets.splice(e,1))}if(this.dying.length){for(e=this.dying.length-1;0<=e;e--)try{this.dying[e].parentNode&&window.ASTEROIDS.enemiesKilled++,this.dying[e].parentNode.removeChild(this.dying[e])}catch(p){}f.points.innerHTML=10*window.ASTEROIDS.enemiesKilled;this.dying=[]}for(e=this.particles.length-1;0<=e;e--)this.particles[e].pos.add(this.particles[e].dir.mulNew(400*c*Math.random())),
1E3<b-this.particles[e].cameAlive&&(this.particles.splice(e,1),a=!0);v&&(this.gameContainer.style.left=this.canvas.style.left=document.documentElement.scrollLeft+"px",this.gameContainer.style.top=this.canvas.style.top=document.documentElement.scrollTop+"px",this.navigation.style.right="10px",this.navigation.style.top=document.documentElement.scrollTop+document.body.clientHeight-this.navigation.clientHeight-10+"px");if(a||0!=this.bullets.length||0!=this.particles.length||!this.pos.is(this.lastPos)||
0<this.vel.len())this.ctx.clear(),this.ctx.drawPlayer(),k&&this.ctx.drawFlames(f.flame),this.bullets.length&&this.ctx.drawBullets(this.bullets),this.particles.length&&this.ctx.drawParticles(this.particles);this.lastPos=this.pos}};var P=setInterval(function(){try{f.update.call(f)}catch(a){throw clearInterval(P),a;}},20)}window.ASTEROIDSPLAYERS||(window.ASTEROIDSPLAYERS=[]);if(window.ActiveXObject&&!document.createElement("canvas").getContext){try{var q=document.createElement("script");q.setAttribute("type",
"text/xaml");q.textContent='<?xml version="1.0"?><Canvas xmlns="http://schemas.microsoft.com/client/2007"></Canvas>';document.getElementsByTagName("head")[0].appendChild(q)}catch(Q){}var m=document.createElement("script");m.setAttribute("type","text/javascript");m.onreadystatechange=function(){"loaded"!=m.readyState&&"complete"!=m.readyState||"undefined"==typeof G_vmlCanvasManager||(window.ASTEROIDSPLAYERS[window.ASTEROIDSPLAYERS.length]=new r)};m.src="./excanvas.js";document.getElementsByTagName("head")[0].appendChild(m)}else window.ASTEROIDSPLAYERS[window.ASTEROIDSPLAYERS.length]=
new r})();